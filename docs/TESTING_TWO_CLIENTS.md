# Инструкция по тестированию синхронизации с двумя клиентами

**Дата создания:** 2025-01-XX  
**Статус:** Готово к тестированию

---

## Цель тестирования

Проверить что синхронизация мультиплеера работает правильно:
- Игроки видят друг друга на правильных позициях
- Локальный игрок видит себя на правильной позиции
- Движения синхронизированы
- Reconciliation работает при движении

---

## Подготовка

1. **Запустить сервер:**
   ```bash
   npm run server
   ```

2. **Открыть два браузера/окна:**
   - Окно 1: `http://localhost:5000` (или ваш адрес сервера)
   - Окно 2: `http://localhost:5000` (или ваш адрес сервера)

3. **Включить отладку (опционально):**
   - В консоли браузера: `localStorage.setItem("debugSync", "true")`
   - Нажать F3 для открытия debug dashboard
   - Проверить секцию "SYNC METRICS"

---

## Процедура тестирования

### Тест 1: Проверка видимости игроков

1. **Окно 1:** Создать комнату (FFA режим)
2. **Окно 2:** Присоединиться к той же комнате
3. **Проверить:**
   - [ ] Окно 1 видит игрока из Окна 2
   - [ ] Окно 2 видит игрока из Окна 1
   - [ ] Оба игрока видят себя на правильной позиции
   - [ ] Позиции совпадают (нет разсинхронизации)

### Тест 2: Проверка синхронизации движения

1. **Окно 1:** Двигаться вперед (W)
2. **Окно 2:** Наблюдать за игроком из Окна 1
3. **Проверить:**
   - [ ] Игрок из Окна 1 движется плавно в Окне 2
   - [ ] Нет "телепортаций" или рывков
   - [ ] Позиция синхронизирована

4. **Окно 2:** Двигаться в сторону (A/D)
5. **Окно 1:** Наблюдать за игроком из Окна 2
6. **Проверить:**
   - [ ] Игрок из Окна 2 поворачивается плавно
   - [ ] Нет задержек или рывков

### Тест 3: Проверка reconciliation

1. **Окно 1:** Быстро двигаться и останавливаться
2. **Окно 2:** Наблюдать за игроком из Окна 1
3. **Проверить:**
   - [ ] Нет больших расхождений (> 2 единиц)
   - [ ] Reconciliation работает плавно (нет резких телепортаций)
   - [ ] В debug dashboard метрики показывают нормальные значения

### Тест 4: Проверка при потере пакетов

1. **Окно 1:** Двигаться непрерывно
2. **Окно 2:** Временно отключить сеть (DevTools → Network → Offline)
3. **Подождать 1-2 секунды**
4. **Окно 2:** Включить сеть обратно
5. **Проверить:**
   - [ ] Dead reckoning работает (игрок продолжает двигаться плавно)
   - [ ] После восстановления связи позиция быстро синхронизируется
   - [ ] Нет больших расхождений

### Тест 5: Проверка башни и прицеливания

1. **Окно 1:** Поворачивать башню и прицеливаться
2. **Окно 2:** Наблюдать за игроком из Окна 1
3. **Проверить:**
   - [ ] Башня синхронизирована
   - [ ] Ствол наклоняется правильно
   - [ ] Нет задержек

---

## Метрики для проверки

В debug dashboard (F3) проверьте секцию "SYNC METRICS":

- **Avg Pos Diff:** Должно быть < 1.0 единицы
- **Max Pos Diff:** Должно быть < 5.0 единиц
- **Reconciliation/s:** Должно быть < 5 в секунду
- **Hard Corrections:** Должно быть минимально (только при больших расхождениях)
- **Large Diffs:** Должно быть 0 или очень мало
- **Critical Diffs:** Должно быть 0
- **Quality:** Должно быть > 60% (good или excellent)

---

## Ожидаемые результаты

✅ **Успешно:**
- Игроки видят друг друга на правильных позициях
- Движения синхронизированы
- Нет больших расхождений
- Reconciliation работает плавно
- Метрики показывают хорошее качество синхронизации

❌ **Проблемы:**
- Игроки не видят друг друга
- Большие расхождения позиций (> 5 единиц)
- Частые hard corrections
- Низкое качество синхронизации (< 40%)

---

## Отчет о тестировании

После тестирования заполните:

**Дата тестирования:** _______________  
**Версия:** _______________  
**Тестер:** _______________

**Результаты:**
- Тест 1: [ ] Успешно [ ] Проблемы: _______________
- Тест 2: [ ] Успешно [ ] Проблемы: _______________
- Тест 3: [ ] Успешно [ ] Проблемы: _______________
- Тест 4: [ ] Успешно [ ] Проблемы: _______________
- Тест 5: [ ] Успешно [ ] Проблемы: _______________

**Метрики:**
- Avg Pos Diff: _______________
- Max Pos Diff: _______________
- Reconciliation/s: _______________
- Quality: _______________

**Замечания:**
_______________

---

**Последнее обновление:** 2025-01-XX

