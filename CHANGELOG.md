# История изменений TX

## [Недатировано] - Исправления и доработки

### Исправлено

#### Отображение угла наклона ствола
- Изменен формат отображения на тысячные единицы (0.001) вместо градусов
- Зафиксирована позиция индикатора (фиксированная точка)
- Заменены стрелки `↗`/`↘` на символы `+` и `-`
- Файлы: `src/client/hud.ts`

#### Физика танков
- Увеличена масса танков с 40000 до 50000 (50 тонн)
- Уменьшена отдача пушек в 2 раза (force: 20000 → 10000, torque: 80000 → 40000)
- Файлы: `src/client/config/physicsConfig.ts`

#### XP BAR
- Исправлено отображение начальных значений вместо актуальных
- Добавлено принудительное обновление XP BAR при установке PlayerProgressionSystem
- Добавлено уведомление об изменении опыта при установке системы прогресса
- **ИСПРАВЛЕНО: Добавлена периодическая синхронизация XP BAR с PlayerProgressionSystem (каждую секунду)**
- Гарантируется синхронизация с SCOREBOARD и другими элементами HUD
- Файлы: `src/client/hud.ts`

#### Точки спавна
- Исправлена логика использования точек спавна с карты
- Если точек спавна нет, используется центр игрового поля над самым верхним объектом
- Улучшен алгоритм поиска безопасной позиции спавна
- Файлы: `src/client/game.ts`

#### Предотвращение застревания
- Улучшена система предотвращения застревания при спавне/респавне/переодевании
- Добавлено использование `findSafeSpawnPositionAt` при респавне для поиска безопасной позиции над верхней поверхностью
- Увеличено количество проверок anti-stuck после спавна/респавна/переодевания
- Добавлена проверка anti-stuck после переодевания танка
- Файлы: `src/client/game.ts`, `src/client/tankController.ts`, `src/client/game/GameGarage.ts`

#### Workflow редактора карт
- Кнопки "Свернуть" и "Закрыть" уже реализованы в редакторе
- После TEST редактор сворачивается и открывается игра
- Добавлена кнопка "Редактор" в игре для разворачивания редактора
- Файлы: `src/client/mapEditor.ts`, `src/client/menu.ts`

#### Меню "Прогресс игрока"
- Методы рендеринга вкладок уже реализованы
- Вкладки "Уровень", "Достижения", "Задания" заполняются данными из PlayerProgressionSystem
- Файлы: `src/client/menu.ts`

#### Оптимизация производительности
- Добавлена периодическая очистка мертвых врагов для предотвращения утечек памяти
- Добавлен метод `cleanupDeadEnemies()` который вызывается каждые 60 кадров
- Улучшена очистка ресурсов врагов при их смерти (вызов `dispose()`)
- Файлы: `src/client/game.ts`

#### Интеграция кастомных карт в мультиплеер
- Исправлена загрузка кастомных карт в мультиплеере
- В мультиплеере используется `pendingCustomMapData` из GAME_START вместо localStorage
- Все игроки получают одинаковые данные карты с сервера
- Сервер сохраняет `customMapData` в комнате и отправляет всем игрокам при GAME_START
- Исправлена логика выбора источника данных карты (pendingCustomMapData для MP, localStorage для SP)
- Файлы: `src/client/game.ts`, `src/server/gameServer.ts`, `src/client/game/GameMultiplayerCallbacks.ts`

### В разработке

- Дальнейшая оптимизация производительности требует профилирования для выявления узких мест
